<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Your Order | AtiyaTrinkets</title>
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #fdf6f0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h2 {
      text-align: center;
      color: #d63384;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #d8b4d3;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #c29dc3;
    }
    .result {
      margin-top: 20px;
    }
    .result p {
      margin: 5px 0;
    }
    .item {
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Track Your Order</h2>
    <input type="text" id="orderIdInput" placeholder="Enter your Order ID">
    <button onclick="trackOrder()">Track</button>

    <div class="result" id="orderResult"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCUkMcVsTmhfZ0PtsGTHJIGU156MjrxqzE",
      authDomain: "atiyatrinkets-ce4b6.firebaseapp.com",
      projectId: "atiyatrinkets-ce4b6",
      storageBucket: "atiyatrinkets-ce4b6.appspot.com",
      messagingSenderId: "562847025664",
      appId: "1:562847025664:web:c200328acd5643c32e66e5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.trackOrder = async function () {
      const orderId = document.getElementById("orderIdInput").value.trim();
      const resultDiv = document.getElementById("orderResult");
      resultDiv.innerHTML = "";

      if (!orderId) {
        alert("Please enter an order ID.");
        return;
      }

      try {
        const orderRef = doc(db, "orders", orderId);
        const orderSnap = await getDoc(orderRef);

        if (!orderSnap.exists()) {
          resultDiv.innerHTML = "<p><strong>No order found with this ID.</strong></p>";
          return;
        }

        const order = orderSnap.data();

        let itemsHTML = "";
        if (Array.isArray(order.cart)) {
          itemsHTML = order.cart.map(item => 
            `<li class="item">${item.name} × ${item.qty} (₹${item.price})</li>`
          ).join("");
        }

        const timestamp = order.timestamp?.toDate?.().toLocaleString?.() || "N/A";

        resultDiv.innerHTML = `
          <p><strong>Name:</strong> ${order.name}</p>
          <p><strong>Email:</strong> ${order.userEmail || "N/A"}</p>
          <p><strong>Phone:</strong> ${order.phone}</p>
          <p><strong>Address:</strong> ${order.address}</p>
          <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>
          <p><strong>Status:</strong> ${order.status || "Pending"}</p>
          <p><strong>Order Date:</strong> ${timestamp}</p>
          <p><strong>Items:</strong></p>
          <ul>${itemsHTML}</ul>
        `;
      } catch (error) {
        console.error("Error fetching order:", error);
        resultDiv.innerHTML = "<p><strong>Error fetching order. Try again later.</strong></p>";
      }
    };
  </script>
</body>
</html>
